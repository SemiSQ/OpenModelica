srcdir= .
top_builddir= ../..
builddir_bin=$(top_builddir)/build/bin
builddir_lib=$(top_builddir)/build/lib
builddir_inc=$(top_builddir)/build/include
builddir_doc=$(top_builddir)/build/doc


BOOST_HOME = @BOOSTHOME@
RMLINCLUDE = @rmlinc@

USE_MODPAR = @USE_MODPAR@

ifdef USE_MODPAR
OBJECTS = Codegen.o \
	TaskMerging.o \
	TaskGraph.o \
	MergeRule.o \
	SingleChildMerge.o \
	DuplicateParentMerge.o \
	MergeAllParents.o \
	MergeSiblings.o \
	Schedule.o \
	TaskGraphExt.o \
	solvers.o
else
OBJECTS = TaskGraphExt_stub.o
endif
.PHONY: install
install: libmodpar.a libmodparomc.a
	cp libmodparomc.a $(builddir_lib)/omc	

libmodpar.a: $(OBJECTS)
	ar -sr $@ $(OBJECTS)

libmodparomc.a: TaskGraphExt_stub_omc.o
	ar -sr $@ $<

INCFLAGS =-I$(RMLINCLUDE) -I$(BOOST_HOME) -I$(top_builddir)/mosh/src

CFLAGS = @CFLAGS@ $(INCFLAGS) -Wall -DUNIX=1
CXXFLAGS = $(CFLAGS)
LIBS =


TaskGraphExt.o: TaskGraphExt.cpp
TaskGraphExt_stub.o: TaskGraphExt_stub.cpp
TaskMerging.o: TaskMerging.cpp TaskMerging.hpp
TaskGraph.o: TaskGraph.cpp TaskGraph.hpp
MergeRule.o: MergeRule.cpp MergeRule.hpp
SingleChildMerge.o: SingleChildMerge.cpp SingleChildMerge.hpp MergeRule.hpp
DuplicateParentMerge.o: DuplicateParentMerge.cpp DuplicateParentMerge.hpp MergeRule.hpp
MergeAllParents.o: MergeAllParents.cpp MergeAllParents.hpp MergeRule.hpp
Schedule.o: Schedule.cpp Schedule.hpp

clean:
	rm -rf *.a $(OBJECTS)

reallyclean: clean

.PRECIOUS: Makefile

Makefile: Makefile.in
	(cd $(top_builddir); ./config.status)
