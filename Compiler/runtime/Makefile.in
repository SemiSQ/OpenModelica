#
# Makefile for Compiler/runtime
#
# David Kågedal <x97davka@ida.liu.se>
#
# $Id$
#

srcdir=../
top_builddir= ../..
builddir_bin=$(top_builddir)/build/bin
builddir_lib=$(top_builddir)/build/lib
builddir_inc=$(top_builddir)/build/include
builddir_doc=$(top_builddir)/build/doc

USE_CORBA = @USE_CORBA@
CORBAHOME = @CORBAHOME@

RMLINCLUDE = @rmlinc@
OSTYP = $(OSTYPE)
OS_MSYS=msys
ifeq ($(OSTYP),$(OS_MSYS))
	CFLAGS = @DEFS@ $(USE_CORBA) -DBUILD_MICO_DLL
else
	CFLAGS = @DEFS@ $(USE_CORBA) -DCYGWIN
endif



ifdef USE_CORBA
  CORBASRC = omc_communication.cc omc_communication_impl.cpp corbaimpl.cpp
  CORBAINCL = -I$(CORBAHOME)/include
else
  CORBASRC = corbaimpl_stub.cpp
  CORBAINCL =  
endif

SHELL	= /bin/sh
CC	= gcc
IDL	= idl 
CFLAGS	+= -I$(RMLINCLUDE) -I$(top_builddir)/c_runtime -I$(srcdir) -I. $(CORBAINCL)
CXXFLAGS = $(CFLAGS)
SRC	= rtopts.c socketimpl.c printimpl.c systemimpl.c settingsimpl.c
CPPSRC  = ptolemyio.cpp daeext.cpp ErrorMessage.cpp errorext.cpp $(CORBASRC)
OBJ     = $(SRC:.c=.o) $(CPPSRC:.cpp=.o) $(CPPSRC:.cc=.o)

all: $(OBJ)

omc_communication.cc omc_communication.h : omc_communication.idl
	$(IDL) omc_communication.idl

omc_communication.h: omc_communication_impl.cpp corbaimpl.cpp

clean:
	$(RM) -rf *.o 
