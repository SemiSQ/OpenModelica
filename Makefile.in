all : release qtclients mosh

autoconfGeneratedFiles = @GENERATED_AUTOCONF_FILES@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
libdir = @libdir@
includedir = @includedir@
datadir = @datadir@
docdir = @docdir@

defaultMakefileTarget = Makefile
QMAKE=@QMAKE@

include Makefile.common

# We don't need OMDEV hacks, but using the same Makefile sure is nice!
.testvariables:
settings:

omc: c_runtime docs
	(cd Compiler && $(MAKE) -f Makefile release)

omcd: c_runtime docs
	(cd Compiler && $(MAKE) -f Makefile debug)

qtclean-common:
	rm -f OMNotebook/ext/ext OMNotebook/ext/OMPlotWindow
	rm -f OMShell/OMShell OMShell/omc_communication.*
	rm -f OMNotebook/OMNotebookQT4/OMNotebook OMNotebook/OMNotebookQT4/omc_communication.*
ifeq ($(QMAKE),)
qtclients:
	@echo "*** OpenModelica configured without support for Qt"
qtclean: qtclean-common
else ifeq (@IDLCMD@,)
qtclients:
	@echo "*** OpenModelica configured without support for CORBA"
qtclean: qtclean-common
else
qtclients: mkbuilddirs
	echo "Coin3D (www.coin3d.org) and SoQt should be installed and in the path!"
	(cd OMShell && (test -f omc_communication.cc || @IDLCMD@ ../Compiler/runtime/omc_communication.idl) && CORBALIBS="@CORBALIBS@" CORBAINCL="@CORBACFLAGS@" $(QMAKE) && make && cp -p OMShell ../$(builddir_bin)/.)
	(cd OMNotebook/ext && $(QMAKE) && make && cp -p OMPlotWindow ../../$(builddir_bin)/.)
	(cd OMNotebook/OMNotebookQT4 && (test -f omc_communication.cc || @IDLCMD@ ../../Compiler/runtime/omc_communication.idl) && $(QMAKE) && make)
	cp -p OMNotebook/OMNotebookQT4/OMNotebook $(builddir_bin)
	cp -p OMNotebook/OMNotebookQT4/*.xml $(builddir_share)/omnotebook
	cp -p OMNotebook/OMNotebookQT4/commands.xml $(builddir_share)/omshell

qtclean: qtclean-common
	rm -f OMNotebook/ext/ext OMNotebook/ext/OMPlotWindow
	rm -f OMShell/OMShell OMShell/omc_communication.*
	rm -f OMNotebook/OMNotebookQT4/OMNotebook OMNotebook/OMNotebookQT4/omc_communication.*
	(cd OMShell && $(QMAKE) && make clean)
	(cd OMNotebook/ext && $(QMAKE) && make clean)
	(cd OMNotebook/OMNotebookQT4 && $(QMAKE) && make clean)
endif

fix-svn-eol-style:
	svn propset svn:eol-style LF `find testsuite/ Compiler/ | grep "\.mos\?\$$"`

.PRECIOUS: Makefile

Makefile: Makefile.in
	$(top_builddir)/config.status
