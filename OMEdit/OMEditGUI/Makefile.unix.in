.PHONY: install build $(NAME) always qm

top_builddir=../../
builddir_bin=$(top_builddir)/build/bin/
builddir_share=$(top_builddir)/build/share/
runtimedir=$(top_builddir)/Compiler/runtime/
resourcedir=./Resources/nls/

NAME=OMEdit
EXE=@EXE@
QMAKE=@QMAKE@

install: build qm
	mkdir -p ../../build/share/doc/omedit/
	cp -p ../../doc/OMEdit/*.pdf ../../build/share/doc/omedit/
	mkdir -p ../../build/share/omedit/nls/
	cp -p $(resourcedir)/*.qm ../../build/share/omedit/nls/
	if [ "$(EXE)" = ".app" ]; then cp -rp ../bin/OMEdit.app ../../build/Applications/ ; else cp -p ../bin/OMEdit ../../build/bin/OMEdit; fi

qm: OMEditGUI.pro
	lrelease $<

always:

omc_communication.cpp: omc_communication.cc
	ln -s $< $@
omc_communication.cc: $(runtimedir)/omc_communication.idl
	@IDLCMD@ $<
omc_communication.h: omc_communication.cc

$(NAME): Makefile OMEdit.config omc_communication.cpp
	$(MAKE) -f Makefile

clean:
	test ! -f Makefile || $(MAKE) -f Makefile clean
	rm -f ../bin/*.o

build: $(NAME)
	$(MAKE) -f Makefile
Makefile: OMEditGUI.pro OMEdit.config
	$(QMAKE)
Makefile.unix: Makefile.unix.in
	(cd ../../; ./config.status)
OMEdit.config: OMEdit.config.in
	(cd ../../; ./config.status)
