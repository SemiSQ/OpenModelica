top_builddir=../../
builddir_bin=$(top_builddir)/build/bin/
builddir_share=$(top_builddir)/build/share/
runtimedir=$(top_builddir)/Compiler/runtime/

QMAKE=@QMAKE@
EXE=@EXE@
NAME=OMPlot
LIB=libOMPlot

.PHONY: always $(NAME) $(LIB)

all: build

Makefile: OMPlotGUI.pro
	$(QMAKE)

Makefile.lib: OMPlotLib.pro
	$(QMAKE) OMPlotLib.pro -o $@

clean:
	test ! -f Makefile || make -f Makefile clean
	test ! -f Makefile.lib || make -f Makefile.lib clean
	rm -rf $(NAME) $(NAME)$(EXE) Makefile

$(NAME)$(EXE): Makefile
	make -f Makefile
ifeq ($(EXE),.app)
$(NAME): $(NAME)$(EXE) always
	cp -p ../bin/$</Contents/MacOS/$(NAME) ../bin/$@
endif

$(LIB): Makefile.lib
	make -f $<

build: $(NAME) $(LIB)
	cp -p ../bin/$(NAME) $(builddir_bin)

Makefile.unix: Makefile.unix.in
	cd $(top_builddir); ./config.status
