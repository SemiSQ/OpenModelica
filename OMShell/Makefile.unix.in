top_builddir=../
builddir_bin=$(top_builddir)/build/bin/
builddir_share=$(top_builddir)/build/share/
runtimedir=$(top_builddir)/Compiler/runtime/

QMAKE=@QMAKE@
EXE=@EXE@
NAME=OMShell

.PHONY: always

all: build

Makefile:
	$(QMAKE)

clean: Makefile
	rm -rf $(NAME) $(NAME)$(EXE) omc_communication.* Makefile

omc_communication.cc omc_communication.h: $(runtimedir)/omc_communication.idl
	@IDLCMD@ $<

$(NAME)$(EXE): Makefile omc_communication.cc
	make -f Makefile
ifeq ($(EXE),.app)
$(NAME): $(NAME)$(EXE) always
	cp -p $</Contents/MacOS/$(NAME) $@
endif

build: $(NAME)
	mkdir -p $(builddir_share)/omshell/
	cp -p $(NAME) $(builddir_bin)
	cp -p ../OMNotebook/OMNotebookQT4/commands.xml $(builddir_share)/omshell/

Makefile.unix: Makefile.unix.in
	cd $(top_builddir); ./config.status
