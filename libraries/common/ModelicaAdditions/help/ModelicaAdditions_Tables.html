<HTML>
<HEAD><META name="HTML-Generator" content="Dymola"><TITLE>ModelicaAdditions</TITLE></HEAD>
<BODY><P>
<H2><A NAME="ModelicaAdditions.Tables"></A><A HREF="ModelicaAdditions.html#ModelicaAdditions"
>ModelicaAdditions</A>.Tables</H2>
<A HREF="ModelicaAdditions_Tables_Examples.html#ModelicaAdditions.Tables.Examples"
><IMG SRC="ModelicaAdditions.Tables.ExamplesI.png" ALT="ModelicaAdditions.Tables.Examples" WIDTH=80  HEIGHT=80 ></A>
<A HREF="ModelicaAdditions_Tables.html#ModelicaAdditions.Tables.CombiTableTime"
><IMG SRC="ModelicaAdditions.Tables.CombiTableTimeI.png" ALT="ModelicaAdditions.Tables.CombiTableTime" WIDTH=80  HEIGHT=80 ></A>
<A HREF="ModelicaAdditions_Tables.html#ModelicaAdditions.Tables.CombiTableTime2"
><IMG SRC="ModelicaAdditions.Tables.CombiTableTime2I.png" ALT="ModelicaAdditions.Tables.CombiTableTime2" WIDTH=80  HEIGHT=80 ></A>
<A HREF="ModelicaAdditions_Tables.html#ModelicaAdditions.Tables.CombiTable1D"
><IMG SRC="ModelicaAdditions.Tables.CombiTable1DI.png" ALT="ModelicaAdditions.Tables.CombiTable1D" WIDTH=80  HEIGHT=80 ></A>
<A HREF="ModelicaAdditions_Tables.html#ModelicaAdditions.Tables.CombiTable1Ds"
><IMG SRC="ModelicaAdditions.Tables.CombiTable1DsI.png" ALT="ModelicaAdditions.Tables.CombiTable1Ds" WIDTH=80  HEIGHT=80 ></A>
<A HREF="ModelicaAdditions_Tables.html#ModelicaAdditions.Tables.CombiTable2D"
><IMG SRC="ModelicaAdditions.Tables.CombiTable2DI.png" ALT="ModelicaAdditions.Tables.CombiTable2D" WIDTH=80  HEIGHT=80 ></A>
<P><P>
<H3>Information</H3>
<PRE></pre>
<p>
This package contains components to <b>interpolate linearly</b> in <b>tables</b>.
Table data may optionally be read in from <b>files</b> (ASCII or Matlab-4
binary format). This package contains the following components:
</p>

<pre>
   <b>CombiTableTime</b>  Table look-up with time as abszissa
   <b>CombiTableTime2</b> Table look-up with time as abszissa and
                   linear/perodic extrapolation methods
   <b>CombiTable1D</b>    Table look-up in one dimension
   <b>CombiTable1Ds</b>   Table look-up in one dimension with
                   same input for different coloumns
   <b>CombiTable2D</b>    Table look-up in two dimensions
</pre>

<p>
This package is not part of the Modelica standard library, because it is
planned to realize a package with better and more general table support
based on a different design.
</p>

<dl>
<dt><b>Main Author:</b>
<dd><a href="http://www.robotic.dlr.de/Martin.Otter/">Martin Otter</a><br>
    Deutsches Zentrum f&uuml;r Luft und Raumfahrt e.V. (DLR)<br>
    Institut f&uuml;r Robotik und Mechatronik<br>
    Postfach 1116<br>
    D-82230 Wessling<br>
    Germany<br>
    email: <A HREF="mailto:Martin.Otter@dlr.de">Martin.Otter@dlr.de</A><br>
</dl>
<br>

<p><b>Release Notes:</b></p>
<ul>
<li><i>October 21, 2002</i>
       by <a href="http://www.robotic.dlr.de/Martin.Otter/">Martin Otter</a>
       and <a href="http://www.robotic.dlr.de/Christian.Schweiger/">Christian Schweiger</a>:<br>
       Added component CombiTable1Ds with single input and multiple output. Example updated.</li>

<li><i>March 31, 2001</i>
       by <a href="http://www.robotic.dlr.de/Martin.Otter/">Martin Otter</a>:<br>
       New component CombiTableTime2 (used CombiTableTime as a basis and added the
       arguments <b>extrapolation, columns, startTime</b>.
       This allows periodic function definitions). Bug fixed for CombiTableTime,
       when table is read from file and starting time is not within the first
       interval of the table.</li>

<li><i>June 11, 2000</i>
       by <a href="http://www.robotic.dlr.de/Martin.Otter/">Martin Otter</a>:<br>
       Realized based on an existing Dymola library of Martin Otter.</li>
</ul>
<br>


<p><b>Copyright &copy; 2000-2002, DLR.</b></p>

<p><i>
The ModelicaAdditions.Tables package is <b>free</b> software;
it can be redistributed and/or modified
under the terms of the <b>Modelica license</b>, see the license conditions
and the accompanying <b>disclaimer</b> in the documentation of package
Modelica in file "Modelica/package.mo".
</i></p>
<pre>
</PRE><P>
<HR>
<H2><IMG SRC="ModelicaAdditions.Tables.CombiTableTimeI.png" ALT="ModelicaAdditions.Tables.CombiTableTime" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="ModelicaAdditions.Tables.CombiTableTime"></A><A HREF="ModelicaAdditions_Tables.html#ModelicaAdditions.Tables"
>ModelicaAdditions.Tables</A>.CombiTableTime</H2>
<B>Table look-up with time as abszissa (matrix/file) </B><p>
<IMG SRC="ModelicaAdditions.Tables.CombiTableTimeD.png" ALT="ModelicaAdditions.Tables.CombiTableTime">
<H3>Information</H3>
<PRE></pre>
<p>
<b>Linear interpolation</b> in a <b>table</b> with respect to <b>time</b>.
Via parameter <b>icol</b> it can be defined how many columns of the
table are interpolated. If, e.g., icol={2,4}, it is assumed that
2 output signals are present and that the first output is computed
by interpolation of column 2 and the second output is computed
by interpolation of column 4 of the table matrix.
</p>

<p>
The time points and function values are stored in a matrix "table[i,j]",
where the first column "table[:,1]" contains the time points and the
other columns contain the data to be interpolated. Example:
</p>

<pre>
   table = [0,  0;
            1,  0;
            1,  1;
            2,  4;
            3,  9;
            4, 16]

  If, e.g., time = 1.0, the output y =  0.0 (before event), 1.0 (after event)
      e.g., time = 1.5, the output y =  2.5,
      e.g., time = 2.0, the output y =  4.0,
      e.g., time = 5.0, the output y = 23.0 (i.e. extrapolation).
</pre>

<ul>
<li> If the table has only <b>one row</b>, the table value is returned,
     independently of time.</li>
<li> If time is <b>outside</b> of the defined <b>interval</b>, i.e.,
     time > table[size(table,1),1] or time < table[1,1], the corresponding
     value is also determined by linear
     interpolation through the last or first two points of the table.</li>
<li> <b>Two successive</b> time instants may be <b>identical</b>
     (see table example) to define a <b>discontinuous</b> point in the function.
     At every defined time instant of the table, a time event occurs in
     order to not integrate over a discontinuous or not differentiable point.
     From the discussion follows that the time values in the first column of
     the table have to be monotonically (but NOT strict monotonically) increasing.</li>
</ul>

<p>
The table matrix can be defined in the following ways:
</p>

<ol>
<li> Explicitly supplied as <b>parameter matrix</b> "table",
     and the other parameters have the following values:
<pre>
   tableName is "NoName" or has only blanks,
   fileName  is "NoName" or has only blanks.
</pre></li>

<li> <b>Read</b> from a <b>file</b> "fileName" where the matrix is stored as
      "tableName". Both ASCII and binary file format is possible.
      (the ASCII format is described below).
      It is most convenient to generate the binary file from Matlab
      (Matlab 4 storage format), e.g., by command
<pre>
   save tables.mat tab1 tab2 tab3 -V4
</pre>
      when the three tables tab1, tab2, tab3 should be
      used from the model.</li>

<li>  Statically stored in function "usertab" in file "usertab.c".
      The matrix is identified by "tableName". Parameter
      fileName = "NoName" or has only blanks.</li>
</ol>

<p>
Table definition methods (1) and (3) do <b>not</b> allocate dynamic memory,
and do not access files, whereas method (2) does. Therefore (1) and (3)
are suited for hardware-in-the-loop simulation (e.g. with dSpace hardware).
When the constant "NO_FILE" is defined, all parts of the
source code of method (2) are removed by the C-preprocessor, such that
no dynamic memory allocation and no access to files takes place.
</p>

<p>
If tables are read from an ASCII-file, the file need to have the
following structure ("-----" is not part of the file content):
</p>

<pre>
-----------------------------------------------------
#1
double tab1(6,2)   # comment line
  0   0
  1   0
  1   1
  2   4
  3   9
  4  16

double tab2(6,2)   # another comment line
  0   0
  2   0
  2   2
  4   8
  6  18
  8  32
-----------------------------------------------------
</pre>

<p>
Note, that the first two characters in the file need to be
"#1". Afterwards, the corresponding matrix has to be declared
with type, name and actual dimensions. Finally, in successive
rows of the file, the elements of the matrix have to be given.
Several matrices may be defined one after another.
</p>

<pre>
</PRE>
<H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>table[:, :]</TD><TD>[0, 0; 1, 1]</TD><TD>table matrix (time = first column)</TD></TR>
<TR><TD>tableName</TD><TD>&quot;NoName&quot;</TD><TD>table name on file or in function usertab(optional)</TD></TR>
<TR><TD>fileName</TD><TD>&quot;NoName&quot;</TD><TD>file where matrix is stored (optional)</TD></TR>
<TR><TD>icol[:]</TD><TD>{2}</TD><TD>columns of table to be interpolated</TD></TR>
</TABLE>
<H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> CombiTableTime <font color="darkgreen">
  &quot;Table look-up with time as abszissa (matrix/file) &quot;</font> 
  <font color="blue">parameter </font>Real table[:, :]=[0, 0; 1, 1] <font color="darkgreen">&quot;table matrix (time = first column)&quot;</font>;
  <font color="blue">parameter </font>String tableName=&quot;NoName&quot; <font color="darkgreen">
    &quot;table name on file or in function usertab(optional)&quot;</font>;
  <font color="blue">parameter </font>String fileName=&quot;NoName&quot; <font color="darkgreen">&quot;file where matrix is stored (optional)&quot;</font>;
  <font color="blue">parameter </font>Real icol[:]={2} <font color="darkgreen">&quot;columns of table to be interpolated&quot;</font>;
  <font color="blue">extends </font><A HREF="../../Modelica/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.MO"
>Modelica.Blocks.Interfaces.MO</A>(<font color="blue">final </font>nout=<font color="red">size</font>(icol, 1));
<font color="blue">protected </font>
  Real tableID(start=0);
<font color="blue">equation </font>
  <font color="blue">when </font><font color="red">initial</font>()<font color="blue"> then</font>
    tableID = <font color="red">dymTableTimeIni</font>(time, 0.0, tableName, fileName, table, 0.0);
  <font color="blue">end when</font>;
  <font color="darkgreen"></font>
  <font color="darkgreen">/*Interpolate with respect to time.*/</font>
  <font color="blue">for </font>i<font color="blue"> in </font>1:nout<font color="blue"> loop</font>
    outPort.signal[i] = <font color="red">dymTableTimeIpo</font>(tableID, icol[i], time);
  <font color="blue">end for</font>;
  <font color="darkgreen"></font>
<font color="blue">end </font>CombiTableTime;
</PRE>
<HR>
<H2><IMG SRC="ModelicaAdditions.Tables.CombiTableTime2I.png" ALT="ModelicaAdditions.Tables.CombiTableTime2" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="ModelicaAdditions.Tables.CombiTableTime2"></A><A HREF="ModelicaAdditions_Tables.html#ModelicaAdditions.Tables"
>ModelicaAdditions.Tables</A>.CombiTableTime2</H2>
<B>Table look-up with respect to time and linear/perodic extrapolation methods (data from matrix/file)</B><p>
<IMG SRC="ModelicaAdditions.Tables.CombiTableTime2D.png" ALT="ModelicaAdditions.Tables.CombiTableTime2">
<H3>Information</H3>
<PRE></pre>
<p>
<p>
This block generates an output signal by <b>linear interpolation</b> in
a table. The time points and function values are stored in a matrix
<b>table[i,j]</b>, where the first column table[:,1] contains the
time points and the other columns contain the data to be interpolated.
Via parameter <b>columns</b> it can be defined which columns of the
table are interpolated. If, e.g., columns={2,4}, it is assumed that
2 output signals are present and that the first output is computed
by interpolation of column 2 and the second output is computed
by interpolation of column 4 of the table matrix.
The table interpolation has the following proporties:
</p>

<ul>
<li>The time points need to be <b>monotonically increasing</b>. </li>
<li><b>Discontinuities</b> are allowed, by providing the same
    time point twice in the table. </li>
<li>Values <b>outside</b> of the table range, are computed by
    <b>extrapolation</b>:
<pre>
  extrapolation = 0: hold the first or last value of the table,
                     if outside of the range.
                = 1: extrapolate through the last or first two
                     points of the table.
                = 2: periodically repeat the table data
                     (periodical function).
</pre></li>
<li>If the table has only <b>one row</b>, no interpolation is performed and
    the table values of this row are just returned.</li>
<li>Via parameters <b>startTime</b> and <b>offset</b> the curve defined
    by the table can be shifted both in time and in the ordinate value.
    The time instants stored in the table are therefore <b>relative</b>
    to <b>startTime</b>.
    If time < startTime, no interpolation is performed and the offsets
    are used as ordinate values. If vector <b>offset</b> has only
    one element, this element is added as offset to all values of the
    columns selected by <b>columns</b>.
<li>The table is implemented in a numerically sound way by
    generating <b>time events</b> at interval boundaries,
    in order to not integrate over a discontinuous or not differentiable
    points.
<li>For special applications it is sometimes needed to know the minimum
    and maximum time instant defined in the table as a parameter. For this
    reason parameters t_min and t_max are provided and can be access from
    the outside of the table object.
</li>
</ul>

<p>
Example:
</p>

<pre>
   table = [0  0
            1  0
            1  1
            2  4
            3  9
            4 16]; extrapolation = 1 (default)

If, e.g., time = 1.0, the output y =  0.0 (before event), 1.0 (after event)
    e.g., time = 1.5, the output y =  2.5,
    e.g., time = 2.0, the output y =  4.0,
    e.g., time = 5.0, the output y = 23.0 (i.e. extrapolation via last 2 points).
</pre>


<p>
The table matrix can be defined in the following ways:
</p>

<ol>
<li> Explicitly supplied as <b>parameter matrix</b> "table",
     and the other parameters have the following values:
<pre>
   tableName is "NoName" or has only blanks,
   fileName  is "NoName" or has only blanks.
</pre></li>

<li> <b>Read</b> from a <b>file</b> "fileName" where the matrix is stored as
      "tableName". Both ASCII and binary file format is possible.
      (the ASCII format is described below).
      It is most convenient to generate the binary file from Matlab
      (Matlab 4 storage format), e.g., by command
<pre>
   save tables.mat tab1 tab2 tab3 -V4
</pre>
      when the three tables tab1, tab2, tab3 should be
      used from the model.</li>

<li>  Statically stored in function "usertab" in file "usertab.c".
      The matrix is identified by "tableName". Parameter
      fileName = "NoName" or has only blanks.</li>
</ol>

<p>
Table definition methods (1) and (3) do <b>not</b> allocate dynamic memory,
and do not access files, whereas method (2) does. Therefore (1) and (3)
are suited for hardware-in-the-loop simulation (e.g. with dSpace hardware).
When the constant "NO_FILE" is defined, all parts of the
source code of method (2) are removed by the C-preprocessor, such that
no dynamic memory allocation and no access to files takes place.
</p>

<p>
If tables are read from an ASCII-file, the file need to have the
following structure ("-----" is not part of the file content):
</p>

<pre>
-----------------------------------------------------
#1
double tab1(6,2)   # comment line
  0   0
  1   0
  1   1
  2   4
  3   9
  4  16

double tab2(6,2)   # another comment line
  0   0
  2   0
  2   2
  4   8
  6  18
  8  32
-----------------------------------------------------
</pre>

<p>
Note, that the first two characters in the file need to be
"#1". Afterwards, the corresponding matrix has to be declared
with type, name and actual dimensions. Finally, in successive
rows of the file, the elements of the matrix have to be given.
Several matrices may be defined one after another.
</p>

<p><b>Release Notes:</b></p>
<ul>
<li><i>March 31, 2001</i>
       by <a href="http://www.robotic.dlr.de/Martin.Otter/">Martin Otter</a>:<br>
       Used CombiTableTime as a basis and added the
       arguments <b>extrapolation, columns, startTime</b>.
       This allows periodic function definitions. </li>
</ul>
<pre>
</PRE>
<H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>table[:, :]</TD><TD>[0, 0; 1, 1]</TD><TD>table matrix (time = first column)</TD></TR>
<TR><TD>tableName</TD><TD>&quot;NoName&quot;</TD><TD>table name on file or in function usertab(optional)</TD></TR>
<TR><TD>fileName</TD><TD>&quot;NoName&quot;</TD><TD>file where matrix is stored (optional)</TD></TR>
<TR><TD>columns[:]</TD><TD>2:size(table, 2)</TD><TD>columns of table to be interpolated</TD></TR>
<TR><TD>offset[:]</TD><TD>{0}</TD><TD>Offsets of output signals</TD></TR>
<TR><TD>extrapolation[1]</TD><TD>{1}</TD><TD>= 0/1/2 constant/last two points/periodic (SAME value for all columns only supported currently)</TD></TR>
<TR><TD>startTime[1]</TD><TD>{0}</TD><TD>Output = offset for time &lt; startTime (SAME value for all columns only supported currently) [s]</TD></TR>
</TABLE>
<H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> CombiTableTime2 <font color="darkgreen">
  &quot;Table look-up with respect to time and linear/perodic extrapolation methods (data from matrix/file)&quot;</font>
   
  <font color="darkgreen"></font>
  <font color="blue">parameter </font>Real table[:, :]=[0, 0; 1, 1] <font color="darkgreen">&quot;table matrix (time = first column)&quot;</font>;
  <font color="blue">parameter </font>String tableName=&quot;NoName&quot; <font color="darkgreen">
    &quot;table name on file or in function usertab(optional)&quot;</font>;
  <font color="blue">parameter </font>String fileName=&quot;NoName&quot; <font color="darkgreen">&quot;file where matrix is stored (optional)&quot;</font>;
  <font color="blue">parameter </font>Integer columns[:]=2:<font color="red">size</font>(table, 2) <font color="darkgreen">
    &quot;columns of table to be interpolated&quot;</font>;
  <font color="blue">parameter </font>Real offset[:]={0} <font color="darkgreen">&quot;Offsets of output signals&quot;</font>;
  <font color="blue">parameter </font>Integer extrapolation[1](
    min={0}, 
    max={2}) = {1} <font color="darkgreen">
    &quot;= 0/1/2 constant/last two points/periodic (SAME value for all columns only supported currently)&quot;</font>
    ;
  <font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>SI.Time</A> startTime[1]={0} <font color="darkgreen">
    &quot;Output = offset for time &lt; startTime (SAME value for all columns only supported currently)&quot;</font>
    ;
  <font color="blue">extends </font><A HREF="../../Modelica/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.MO"
>Modelica.Blocks.Interfaces.MO</A>(<font color="blue">final </font>nout=<font color="red">max</font>([<font color="red">size</font>(columns, 1); <font color="red">size</font>(
        offset, 1)]));
  <font color="darkgreen"></font>
  <font color="blue">final </font><font color="blue">parameter </font>Real p_offset[nout]=(<font color="blue">if </font><font color="red">size</font>(offset, 1) == 1<font color="blue"> then </font><font color="red">ones</font>(nout)*
      offset[1]<font color="blue"> else </font>offset);
  <font color="darkgreen"></font>
  <font color="blue">final </font><font color="blue">parameter </font>Integer tableID=<font color="red">tableTimeInit</font>(0.0, startTime[1], 0, 
      extrapolation[1], tableName, fileName, table, 0);
  <font color="blue">final </font><font color="blue">parameter </font>Real t_min=<font color="red">tableTimeTmin</font>(tableID);
  <font color="blue">final </font><font color="blue">parameter </font>Real t_max=<font color="red">tableTimeTmax</font>(tableID);
  <font color="darkgreen"></font>
  <font color="blue">function</font> tableTimeInit 
    <font color="blue">input </font>Real timeIn;
    <font color="blue">input </font>Real startTime;
    <font color="blue">input </font>Integer ipoType;
    <font color="blue">input </font>Integer expoType;
    <font color="blue">input </font>String tableName;
    <font color="blue">input </font>String fileName;
    <font color="blue">input </font>Real table[:, :];
    <font color="blue">input </font>Integer colWise;
    <font color="blue">output </font>Integer tableID;
  <font color="blue">external </font>&quot;C&quot; tableID = <font color="red">dymTableTimeIni2</font>(timeIn, startTime, ipoType, expoType
      , tableName, fileName, table, <font color="red">size</font>(table, 1), <font color="red">size</font>(table, 2), colWise);
  <font color="blue">end </font>tableTimeInit;
  <font color="darkgreen"></font>
  <font color="blue">function</font> tableTimeIpo 
    <font color="blue">input </font>Integer tableID;
    <font color="blue">input </font>Integer icol;
    <font color="blue">input </font>Real timeIn;
    <font color="blue">output </font>Real value;
  <font color="blue">external </font>&quot;C&quot; value = <font color="red">dymTableTimeIpo2</font>(tableID, icol, timeIn);
  <font color="blue">end </font>tableTimeIpo;
  <font color="darkgreen"></font>
  <font color="blue">function</font> tableTimeTmin 
    <font color="blue">input </font>Integer tableID;
    <font color="blue">output </font>Real Tmin <font color="darkgreen">&quot;minimum time value in table&quot;</font>;
  <font color="blue">external </font>&quot;C&quot; Tmin = <font color="red">dymTableTimeTmin</font>(tableID);
  <font color="blue">end </font>tableTimeTmin;
  <font color="darkgreen"></font>
  <font color="blue">function</font> tableTimeTmax 
    <font color="blue">input </font>Integer tableID;
    <font color="blue">output </font>Real Tmax <font color="darkgreen">&quot;maximum time value in table&quot;</font>;
  <font color="blue">external </font>&quot;C&quot; Tmax = <font color="red">dymTableTimeTmax</font>(tableID);
  <font color="blue">end </font>tableTimeTmax;
<font color="blue">equation </font>
  <font color="blue">for </font>i<font color="blue"> in </font>1:nout<font color="blue"> loop</font>
    outPort.signal[i] = p_offset[i] + <font color="red">tableTimeIpo</font>(tableID, columns[i], time);
  <font color="blue">end for</font>;
<font color="blue">end </font>CombiTableTime2;
</PRE>
<HR>
<H2><IMG SRC="ModelicaAdditions.Tables.CombiTable1DI.png" ALT="ModelicaAdditions.Tables.CombiTable1D" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="ModelicaAdditions.Tables.CombiTable1D"></A><A HREF="ModelicaAdditions_Tables.html#ModelicaAdditions.Tables"
>ModelicaAdditions.Tables</A>.CombiTable1D</H2>
<B>Table look-up in one dimension (matrix/file) </B><p>
<IMG SRC="ModelicaAdditions.Tables.CombiTable1DD.png" ALT="ModelicaAdditions.Tables.CombiTable1D">
<H3>Information</H3>
<PRE></pre>
<p>
<b>Linear interpolation</b> in <b>one</b> dimension of a <b>table</b>.
Via parameter <b>icol</b> it can be defined how many columns of the
table are interpolated. If, e.g., icol={2,4}, it is assumed that 2 input
and 2 output signals are present and that the first output interpolates
the first input via column 2 and the second output interpolates the
second input via column 4 of the table matrix.
</p>

<p>
The grid points and function values are stored in a matrix "table[i,j]",
where the first column "table[:,1]" contains the grid points and the
other columns contain the data to be interpolated. Example:
</p>

<pre>
   table = [0,  0;
            1,  1;
            2,  4;
            4, 16]

   If, e.g., the input u = 1.0, the output y =  1.0,
       e.g., the input u = 1.5, the output y =  2.5,
       e.g., the input u = 2.0, the output y =  4.0,
       e.g., the input u =-1.0, the output y = -1.0 (i.e. extrapolation).
</pre>

<ul>
<li> The interpolation is <b>efficient</b>, because a search for a new interpolation
     starts at the interval used in the last call.</li>
<li> If the table has only <b>one row</b>, the table value is returned,
     independent of the value of the input signal.</li>
<li> If the input signal <b>u</b> is <b>outside</b> of the defined <b>interval</b>, i.e.,
     u > table[size(table,1),1] or u < table[1,1], the corresponding
     value is also determined by linear
     interpolation through the last or first two points of the table.</li>
<li> The grid values (first column) have to be <b>strict</b>
     monotonically increasing.</li>
</ul>

<p>
The table matrix can be defined in the following ways:
</p>

<ol>
<li> Explicitly supplied as <b>parameter matrix</b> "table",
     and the other parameters have the following values:
<pre>
   tableName is "NoName" or has only blanks,
   fileName  is "NoName" or has only blanks.
</pre></li>

<li> <b>Read</b> from a <b>file</b> "fileName" where the matrix is stored as
      "tableName". Both ASCII and binary file format is possible.
      (the ASCII format is described below).
      It is most convenient to generate the binary file from Matlab
      (Matlab 4 storage format), e.g., by command
<pre>
   save tables.mat tab1 tab2 tab3 -V4
</pre>
      when the three tables tab1, tab2, tab3 should be
      used from the model.</li>

<li>  Statically stored in function "usertab" in file "usertab.c".
      The matrix is identified by "tableName". Parameter
      fileName = "NoName" or has only blanks.</li>
</ol>

<p>
Table definition methods (1) and (3) do <b>not</b> allocate dynamic memory,
and do not access files, whereas method (2) does. Therefore (1) and (3)
are suited for hardware-in-the-loop simulation (e.g. with dSpace hardware).
When the constant "NO_FILE" is defined, all parts of the
source code of method (2) are removed by the C-preprocessor, such that
no dynamic memory allocation and no access to files takes place.
</p>

<p>
If tables are read from an ASCII-file, the file need to have the
following structure ("-----" is not part of the file content):
</p>

<pre>
-----------------------------------------------------
#1
double tab1(5,2)   # comment line
  0   0
  1   1
  2   4
  3   9
  4  16

double tab2(5,2)   # another comment line
  0   0
  2   2
  4   8
  6  18
  8  32
-----------------------------------------------------
</pre>

<p>
Note, that the first two characters in the file need to be
"#1". Afterwards, the corresponding matrix has to be declared
with type, name and actual dimensions. Finally, in successive
rows of the file, the elements of the matrix have to be given.
Several matrices may be defined one after another.
</p>

<pre>
</PRE>
<H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>table[:, :]</TD><TD>[0, 0; 1, 1]</TD><TD>table matrix (grid = first column)</TD></TR>
<TR><TD>tableName</TD><TD>&quot;NoName&quot;</TD><TD>table name on file or in function usertab(optional)</TD></TR>
<TR><TD>fileName</TD><TD>&quot;NoName&quot;</TD><TD>file where matrix is stored (optional)</TD></TR>
<TR><TD>icol[:]</TD><TD>{2}</TD><TD>columns of table to be interpolated</TD></TR>
</TABLE>
<H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> CombiTable1D <font color="darkgreen">&quot;Table look-up in one dimension (matrix/file) &quot;</font> 
  <font color="blue">parameter </font>Real table[:, :]=[0, 0; 1, 1] <font color="darkgreen">&quot;table matrix (grid = first column)&quot;</font>;
  <font color="blue">parameter </font>String tableName=&quot;NoName&quot; <font color="darkgreen">
    &quot;table name on file or in function usertab(optional)&quot;</font>;
  <font color="blue">parameter </font>String fileName=&quot;NoName&quot; <font color="darkgreen">&quot;file where matrix is stored (optional)&quot;</font>;
  <font color="blue">parameter </font>Real icol[:]={2} <font color="darkgreen">&quot;columns of table to be interpolated&quot;</font>;
  <font color="blue">extends </font><A HREF="../../Modelica/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.MIMOs"
>Modelica.Blocks.Interfaces.MIMOs</A>(<font color="blue">final </font>n=<font color="red">size</font>(icol, 1));
<font color="blue">protected </font>
  Real tableID(start=0);
<font color="blue">equation </font>
  <font color="blue">when </font><font color="red">initial</font>()<font color="blue"> then</font>
    tableID = <font color="red">dymTableInit</font>(1.0, 0.0, tableName, fileName, table, 0.0);
  <font color="blue">end when</font>;
  <font color="darkgreen"></font>
  <font color="blue">for </font>i<font color="blue"> in </font>1:n<font color="blue"> loop</font>
    y[i] = <font color="red">dymTableIpo1</font>(tableID, icol[i], u[i]);
  <font color="blue">end for</font>;
<font color="blue">end </font>CombiTable1D;
</PRE>
<HR>
<H2><IMG SRC="ModelicaAdditions.Tables.CombiTable1DsI.png" ALT="ModelicaAdditions.Tables.CombiTable1Ds" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="ModelicaAdditions.Tables.CombiTable1Ds"></A><A HREF="ModelicaAdditions_Tables.html#ModelicaAdditions.Tables"
>ModelicaAdditions.Tables</A>.CombiTable1Ds</H2>
<B>Table look-up in one dimension (matrix/file) with only single input</B><p>
<IMG SRC="ModelicaAdditions.Tables.CombiTable1DsD.png" ALT="ModelicaAdditions.Tables.CombiTable1Ds">
<H3>Information</H3>
<PRE></pre>
<p>
<b>Linear interpolation</b> in <b>one</b> dimension of a <b>table</b>.
Via parameter <b>icol</b> it can be defined how many columns of the
table are interpolated. If, e.g., icol={2,4}, it is assumed that one input
and 2 output signals are present and that the first output interpolates
via column 2 and the second output interpolates via column 4 of the
table matrix.
</p>

<p>
The grid points and function values are stored in a matrix "table[i,j]",
where the first column "table[:,1]" contains the grid points and the
other columns contain the data to be interpolated. Example:
</p>

<pre>
   table = [0,  0;
            1,  1;
            2,  4;
            4, 16]

   If, e.g., the input u = 1.0, the output y =  1.0,
       e.g., the input u = 1.5, the output y =  2.5,
       e.g., the input u = 2.0, the output y =  4.0,
       e.g., the input u =-1.0, the output y = -1.0 (i.e. extrapolation).
</pre>

<ul>
<li> The interpolation is <b>efficient</b>, because a search for a new interpolation
     starts at the interval used in the last call.</li>
<li> If the table has only <b>one row</b>, the table value is returned,
     independent of the value of the input signal.</li>
<li> If the input signal <b>u</b> is <b>outside</b> of the defined <b>interval</b>, i.e.,
     u > table[size(table,1),1] or u < table[1,1], the corresponding
     value is also determined by linear
     interpolation through the last or first two points of the table.</li>
<li> The grid values (first column) have to be <b>strict</b>
     monotonically increasing.</li>
</ul>

<p>
The table matrix can be defined in the following ways:
</p>

<ol>
<li> Explicitly supplied as <b>parameter matrix</b> "table",
     and the other parameters have the following values:
<pre>
   tableName is "NoName" or has only blanks,
   fileName  is "NoName" or has only blanks.
</pre></li>

<li> <b>Read</b> from a <b>file</b> "fileName" where the matrix is stored as
      "tableName". Both ASCII and binary file format is possible.
      (the ASCII format is described below).
      It is most convenient to generate the binary file from Matlab
      (Matlab 4 storage format), e.g., by command
<pre>
   save tables.mat tab1 tab2 tab3 -V4
</pre>
      when the three tables tab1, tab2, tab3 should be
      used from the model.</li>

<li>  Statically stored in function "usertab" in file "usertab.c".
      The matrix is identified by "tableName". Parameter
      fileName = "NoName" or has only blanks.</li>
</ol>

<p>
Table definition methods (1) and (3) do <b>not</b> allocate dynamic memory,
and do not access files, whereas method (2) does. Therefore (1) and (3)
are suited for hardware-in-the-loop simulation (e.g. with dSpace hardware).
When the constant "NO_FILE" is defined, all parts of the
source code of method (2) are removed by the C-preprocessor, such that
no dynamic memory allocation and no access to files takes place.
</p>

<p>
If tables are read from an ASCII-file, the file need to have the
following structure ("-----" is not part of the file content):
</p>

<pre>
-----------------------------------------------------
#1
double tab1(5,2)   # comment line
  0   0
  1   1
  2   4
  3   9
  4  16

double tab2(5,2)   # another comment line
  0   0
  2   2
  4   8
  6  18
  8  32
-----------------------------------------------------
</pre>

<p>
Note, that the first two characters in the file need to be
"#1". Afterwards, the corresponding matrix has to be declared
with type, name and actual dimensions. Finally, in successive
rows of the file, the elements of the matrix have to be given.
Several matrices may be defined one after another.
</p>

<pre>
</PRE>
<H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>table[:, :]</TD><TD>[0, 0; 1, 1]</TD><TD>table matrix (grid = first column)</TD></TR>
<TR><TD>tableName</TD><TD>&quot;NoName&quot;</TD><TD>table name on file or in function usertab(optional)</TD></TR>
<TR><TD>fileName</TD><TD>&quot;NoName&quot;</TD><TD>file where matrix is stored (optional)</TD></TR>
<TR><TD>icol[:]</TD><TD>{2}</TD><TD>columns of table to be interpolated</TD></TR>
</TABLE>
<H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> CombiTable1Ds <font color="darkgreen">
  &quot;Table look-up in one dimension (matrix/file) with only single input&quot;</font>
   
  <font color="blue">parameter </font>Real table[:, :]=[0, 0; 1, 1] <font color="darkgreen">&quot;table matrix (grid = first column)&quot;</font>;
  <font color="blue">parameter </font>String tableName=&quot;NoName&quot; <font color="darkgreen">
    &quot;table name on file or in function usertab(optional)&quot;</font>;
  <font color="blue">parameter </font>String fileName=&quot;NoName&quot; <font color="darkgreen">&quot;file where matrix is stored (optional)&quot;</font>;
  <font color="blue">parameter </font>Real icol[:]={2} <font color="darkgreen">&quot;columns of table to be interpolated&quot;</font>;
  <font color="blue">extends </font><A HREF="../../Modelica/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.SIMO"
>Modelica.Blocks.Interfaces.SIMO</A>(<font color="blue">final </font>nout=<font color="red">size</font>(icol, 1));
<font color="blue">protected </font>
  Real tableID(start=0);
<font color="blue">equation </font>
  <font color="blue">when </font><font color="red">initial</font>()<font color="blue"> then</font>
    tableID = <font color="red">dymTableInit</font>(1.0, 0.0, tableName, fileName, table, 0.0);
  <font color="blue">end when</font>;
  <font color="darkgreen"></font>
  <font color="blue">for </font>i<font color="blue"> in </font>1:nout<font color="blue"> loop</font>
    y[i] = <font color="red">dymTableIpo1</font>(tableID, icol[i], u);
  <font color="blue">end for</font>;
<font color="blue">end </font>CombiTable1Ds;
</PRE>
<HR>
<H2><IMG SRC="ModelicaAdditions.Tables.CombiTable2DI.png" ALT="ModelicaAdditions.Tables.CombiTable2D" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="ModelicaAdditions.Tables.CombiTable2D"></A><A HREF="ModelicaAdditions_Tables.html#ModelicaAdditions.Tables"
>ModelicaAdditions.Tables</A>.CombiTable2D</H2>
<B>Table look-up in two dimensions (matrix/file) </B><p>
<IMG SRC="ModelicaAdditions.Tables.CombiTable2DD.png" ALT="ModelicaAdditions.Tables.CombiTable2D">
<H3>Information</H3>
<PRE></pre>
<p>
<b>Linear interpolation</b> in <b>two</b> dimensions of a <b>table</b>.
The grid points and function values are stored in a matrix "table[i,j]",
where:
</p>

<ul>
<li> the first column "table[2:,1]" contains the u[1] grid points,</li>
<li> the first row "table[1,2:]" contains the u[2] grid points,</li>
<li> the other rows and columns contain the data to be interpolated.</li>
</ul>

<p>
Example:
</p>

<pre>
           |       |       |       |
           |  1.0  |  2.0  |  3.0  |  // u2
       ----*-------*-------*-------*
       1.0 |  1.0  |  3.0  |  5.0  |
       ----*-------*-------*-------*
       2.0 |  2.0  |  4.0  |  6.0  |
       ----*-------*-------*-------*
     // u1

   is defined as

      table = [0.0,   1.0,   2.0,   3.0;
               1.0,   1.0,   3.0,   5.0;
               2.0,   2.0,   4.0,   6.0]

   If, e.g. the input u is [1.0;1.0], the output y is 1.0,
       e.g. the input u is [2.0;1.5], the output y is 3.0.
</pre>

<ul>
<li> The interpolation is <b>efficient</b>, because a search for a new interpolation
     starts at the interval used in the last call.</li>
<li> If the table has only <b>one element</b>, the table value is returned,
     independent of the value of the input signal.</li>
<li> If the input signal <b>u</b> is <b>outside</b> of the defined <b>interval</b>,
     the corresponding value is also determined by linear
     interpolation through the last or first two points of the table.</li>
<li> The grid values (first column and first row) have to be <b>strict</b>
     monotonically increasing.</li>
</ul>

<p>
The table matrix can be defined in the following ways:
</p>

<ol>
<li> Explicitly supplied as <b>parameter matrix</b> "table",
     and the other parameters have the following values:
<pre>
   tableName is "NoName" or has only blanks,
   fileName  is "NoName" or has only blanks.
</pre></li>

<li> <b>Read</b> from a <b>file</b> "fileName" where the matrix is stored as
      "tableName". Both ASCII and binary file format is possible.
      (the ASCII format is described below).
      It is most convenient to generate the binary file from Matlab
      (Matlab 4 storage format), e.g., by command
<pre>
   save tables.mat tab1 tab2 tab3 -V4
</pre>
      when the three tables tab1, tab2, tab3 should be
      used from the model.</li>

<li>  Statically stored in function "usertab" in file "usertab.c".
      The matrix is identified by "tableName". Parameter
      fileName = "NoName" or has only blanks.</li>
</ol>

<p>
Table definition methods (1) and (3) do <b>not</b> allocate dynamic memory,
and do not access files, whereas method (2) does. Therefore (1) and (3)
are suited for hardware-in-the-loop simulation (e.g. with dSpace hardware).
When the constant "NO_FILE" is defined, all parts of the
source code of method (2) are removed by the C-preprocessor, such that
no dynamic memory allocation and no access to files takes place.
</p>

<p>
If tables are read from an ASCII-file, the file need to have the
following structure ("-----" is not part of the file content):
</p>

<pre>
-----------------------------------------------------
#1
double tab1(5,2)   # comment line
  0   0
  1   1
  2   4
  3   9
  4  16

double tab2(5,2)   # another comment line
  0   0
  2   2
  4   8
  6  18
  8  32
-----------------------------------------------------
</pre>

<p>
Note, that the first two characters in the file need to be
"#1". Afterwards, the corresponding matrix has to be declared
with type, name and actual dimensions. Finally, in successive
rows of the file, the elements of the matrix have to be given.
Several matrices may be defined one after another.
</p>

<pre>
</PRE>
<H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>table[:, :]</TD><TD>[0, 0, 1; 0, 0, 1; 1, 1, 1]</TD><TD>table matrix (grid = first column/first row)</TD></TR>
<TR><TD>tableName</TD><TD>&quot;NoName&quot;</TD><TD>table name on file or in function usertab(optional)</TD></TR>
<TR><TD>fileName</TD><TD>&quot;NoName&quot;</TD><TD>file where matrix is stored (optional)</TD></TR>
</TABLE>
<H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> CombiTable2D <font color="darkgreen">&quot;Table look-up in two dimensions (matrix/file) &quot;</font> 
  <font color="blue">extends </font><A HREF="../../Modelica/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.SI2SO"
>Modelica.Blocks.Interfaces.SI2SO</A>;
  <font color="blue">parameter </font>Real table[:, :]=[0, 0, 1; 0, 0, 1; 1, 1, 1] <font color="darkgreen">
    &quot;table matrix (grid = first column/first row)&quot;</font>;
  <font color="blue">parameter </font>String tableName=&quot;NoName&quot; <font color="darkgreen">
    &quot;table name on file or in function usertab(optional)&quot;</font>;
  <font color="blue">parameter </font>String fileName=&quot;NoName&quot; <font color="darkgreen">&quot;file where matrix is stored (optional)&quot;</font>;
<font color="blue">protected </font>
  Real tableID(start=0);
<font color="blue">equation </font>
  <font color="blue">when </font><font color="red">initial</font>()<font color="blue"> then</font>
    tableID = <font color="red">dymTableInit</font>(2.0, 0.0, tableName, fileName, table, 0.0);
  <font color="blue">end when</font>;
  <font color="darkgreen"></font>
  y = <font color="red">dymTableIpo2</font>(tableID, u1, u2);
<font color="blue">end </font>CombiTable2D;
</PRE>
<HR>
<address>HTML-documentation generated by <a href="http://www.dynasim.se/">Dymola</a> Tue Dec 10 16:33:16 2002
.
</address></BODY>
</HTML>
