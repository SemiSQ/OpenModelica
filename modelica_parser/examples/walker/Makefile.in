CC=gcc
CXX=g++

ANTLR_HOME = @antlrhome@

ANTLR_INCP = -I@antlrinc@
ANTLR_LIBP = -L@antlrlib@

PARSE_INCP = -I../../src
PARSE_LIBP = -L../../src

INCP = $(ANTLR_INCP) $(PARSE_INCP)
LIBP = $(ANTLR_LIBP) $(PARSE_LIBP)

CFLAGS = $(INCP) -g -Wall -DDEBUG
CXXFLAGS = $(CFLAGS)
LINKFLAGS = $(LIBP)

LIBS = -lantlr -lmodelica_parser

PARSER_OBJS = ../../src/modelica_parser.o ../../src/modelica_lexer.o ../../src/token_names.o ../../src/parse_tree_dumper.o

HELPER_OBJS = indentation.o

walkergen= modelica_tree_parser.cpp modelica_tree_parser.hpp \
	   modelica_tree_parserTokenTypes.hpp modelica_tree_parserTokenTypes.txt

walkersrcs=$(filter %.cpp,$(walkergen))
walkerobjs=$(walkersrcs:.cpp=.o)

OBJS += $(walkerobjs) walker.o $(PARSER_OBJS) $(HELPER_OBJS)

ANTLR = java -cp $(ANTLR_HOME) antlr.Tool

all : parser walker

parser:
	cd ../../src; $(MAKE) -f Makefile

walker : $(OBJS) 
	$(CXX) -o $@ $(OBJS) $(LINKFLAGS) $(LIBS) 

$(walkergen): walker.g modelica_parserTokenTypes.txt
	java antlr.Tool $(ANTLRFLAGS) $<


modelica_parserTokenTypes.txt : ../../src/modelica_parserTokenTypes.txt
	cp ../../src/modelica_parserTokenTypes.txt .

clean:
	-rm -f *.o *~ core *.core walker

reallyclean: clean
	-rm -f $(walkergen) modelica_parserTokenTypes.txt


walker.o : walker.cpp ../../src/modelica_lexer.hpp ../../src/modelica_parser.hpp


