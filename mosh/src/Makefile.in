
top_builddir=../..
builddir_bin=$(top_builddir)/build/bin
builddir_lib=$(top_builddir)/build/lib
builddir_inc=$(top_builddir)/build/include
builddir_doc=$(top_builddir)/build/doc


CC=@CC@
CXX=@CXX@

EXEEXT=@EXEEXT@

USE_CORBA = @USE_CORBA@

ifdef USE_CORBA
  CORBAIMPL = -I$(top_builddir)/Compiler/runtime
  CORBAOBJS = $(top_builddir)/Compiler/runtime/omc_communication.o #$(top_builddir)/Compiler/runtime/omc_communication_impl.o
  CORBALIB = @CORBALIBS@
  CORBAINC = @CORBACFLAGS@
else
  CORBAIMPL =
  CORBAOBJS =
  CORBALIB =
endif

INCP = $(CORBAIMPL) $(CORBAINC)

CFLAGS = @CFLAGS@ $(INCP) -g -Wall -DDEBUG $(USE_CORBA)
CXXFLAGS = $(CFLAGS)
LINKFLAGS = @LDFLAGS@

LIBS = -lreadline -lncurses $(CORBALIB) -lm -lpthread


OBJS += mosh.o options.o

PROG = OMShell-terminal

all: release


release: $(PROG)$(EXEEXT)
	cp $(PROG)$(EXEEXT) $(builddir_bin)/

$(PROG)$(EXEEXT) : $(OBJS)
	$(CXX) -o $(PROG)$(EXEEXT) $(OBJS) $(CORBAOBJS) $(LINKFLAGS) $(LIBS)

.cpp.o:
	$(CXX) $(CXXFLAGS) -c $<


clean:
	-rm -f *.o *~ core *.core $(PROG)$(EXEEXT) $(builddir_bin)/$(PROG)$(EXEEXT)


mosh.o : mosh.cpp
options.o: options.cpp


.PRECIOUS: Makefile

Makefile: Makefile.in
	cd $(top_builddir) && ./config.status
